"use strict";(self.webpackChunkMetaSaga_Warriors=self.webpackChunkMetaSaga_Warriors||[]).push([[8452],{66620:(e,t,i)=>{function n(e){return"string"===typeof e?Number.parseInt(e,"0x"===e.trim().substring(0,2)?16:10):"bigint"===typeof e?Number(e):e}i.d(t,{n:()=>n})},88452:(e,t,i)=>{i.d(t,{EmbeddedWalletConnector:()=>M});var n=i(94272),a=i(88612),s=i(70036),r=i(66620),o=i(36152),l=i(10664),c=i(80080),d=i(75672),h=i(5952),u=i(72728),p=i(79784);const w=()=>{var e;return"true"===localStorage.getItem("IS_THIRDWEB_DEV")?null!==(e=window.localStorage.getItem("THIRDWEB_DEV_URL"))&&void 0!==e?e:"http://localhost:3000":"https://embedded-wallet.thirdweb.com"},g=e=>"thirdwebEwsWalletUserId-".concat(e),m=e=>"".concat("walletToken","-").concat(e),I=(e,t)=>"".concat("a","-").concat(e,"-").concat(t);let v=function(e){return e.COGNITO="Cognito",e.GOOGLE="Google",e.EMAIL_OTP="EmailOtp",e.CUSTOM_JWT="CustomJWT",e.CUSTOM_AUTH_ENDPOINT="CustomAuthEndpoint",e.FACEBOOK="Facebook",e.APPLE="Apple",e}({}),y=function(e){return e.LOGGED_OUT="Logged Out",e.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",e.LOGGED_IN_NEW_DEVICE="Logged In, New Device",e.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",e}({});const E=new Map;class L{constructor(e){let{clientId:t}=e;this.isSupported=!!window.localStorage,this.clientId=t}async getItem(e){return this.isSupported?window.localStorage.getItem(e):null!==(t=E.get(e))&&void 0!==t?t:null;var t}async setItem(e,t){if(this.isSupported)return window.localStorage.setItem(e,t);E.set(e,t)}async removeItem(e){const t=await this.getItem(e);return!(!this.isSupported||!t)&&(window.localStorage.removeItem(e),!0)}async saveAuthCookie(e){await this.setItem(m(this.clientId),e)}async getAuthCookie(){return this.getItem(m(this.clientId))}async removeAuthCookie(){return this.removeItem(m(this.clientId))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(I(this.clientId,t),e)}async getDeviceShare(){const e=await this.getWalletUserId();return e?this.getItem(I(this.clientId,e)):null}async removeDeviceShare(){const e=await this.getWalletUserId();return!!e&&this.removeItem(I(this.clientId,e))}async getWalletUserId(){return this.getItem(g(this.clientId))}async saveWalletUserId(e){await this.setItem(g(this.clientId),e)}async removeWalletUserId(){return this.removeItem(g(this.clientId))}}function f(e){return new Promise((t=>{setTimeout(t,1e3*e)}))}const W={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},S=new Map;class b{constructor(e){let{link:t,iframeId:i,container:n=document.body,iframeStyles:s,onIframeInitialize:r}=e;(0,a._)(this,"POLLING_INTERVAL_SECONDS",1.4),this.iframeBaseUrl=w();let o=document.getElementById(i);const l=new URL(t),c="2.4.6";if(l.searchParams.set("sdkVersion",c),!o||o.src!==l.href){if(!o){o=document.createElement("iframe");const e={...W,...s};Object.assign(o.style,e),o.setAttribute("id",i),o.setAttribute("fetchpriority","high"),n.appendChild(o)}o.src=l.href,o.setAttribute("data-version",c);const e=t=>{if("ewsIframeLoaded"===t.data.eventType){if(window.removeEventListener("message",e),!o)return void console.warn("thirdweb Iframe not found");this.onIframeLoadHandler(o,r)()}};window.addEventListener("message",e)}this.iframe=o}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{const i=new Promise((async(i,n)=>{var a;const s=new MessageChannel;s.port1.onmessage=a=>{const{data:r}=a;return s.port1.close(),r.success?(S.set(e.src,!0),t&&t(),i(!0)):n(new Error(r.error))};null===e||void 0===e||null===(a=e.contentWindow)||void 0===a||a.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[s.port2])}));await i}}async call(e){let{procedureName:t,params:i,showIframe:n=!1}=e;for(;!S.get(this.iframe.src);)await f(this.POLLING_INTERVAL_SECONDS);n&&(this.iframe.style.display="block",await f(.005));const a=new Promise(((e,a)=>{var s;const r=new MessageChannel;r.port1.onmessage=async t=>{const{data:i}=t;r.port1.close(),n&&(await f(.1),this.iframe.style.display="none"),i.success?e(i.data):a(new Error(i.error))},null===(s=this.iframe.contentWindow)||void 0===s||s.postMessage({eventType:t,data:i},this.iframeBaseUrl,[r.port2])}));return a}destroy(){S.delete(this.iframe.src)}}class _ extends b{constructor(e){let{clientId:t,customizationOptions:i}=e;super({iframeId:O,link:A({clientId:t,path:"/sdk/2022-08-12/embedded-wallet",queryParams:i}).href,container:document.body}),this.clientId=t}async onIframeLoadedInitVariables(){const e=new L({clientId:this.clientId});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId}}}function A(e){let{clientId:t,path:i,queryParams:n}=e;const a=new URL("".concat(i),w());if(n)for(const r of Object.keys(n)){var s;a.searchParams.set(r,(null===(s=n[r])||void 0===s?void 0:s.toString())||"")}return a.searchParams.set("clientId",t),a}const O="thirdweb-embedded-wallet-iframe";class D{constructor(e){let{querier:t,preLogin:i,postLogin:n,clientId:a}=e;this.LoginQuerier=t,this.preLogin=i,this.postLogin=n,this.clientId=a}async sendEmailLoginOtp(e){let{email:t}=e;await this.preLogin();return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}}class C extends D{constructor(){super(...arguments),(0,a._)(this,"closeWindow",(e=>{let{isWindowOpenedByFn:t,win:i,closeOpenedWindow:n}=e;t?null===i||void 0===i||i.close():i&&n?n(i):i&&i.close()}))}async getOauthLoginUrl(e){return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}async loginWithModal(){await this.preLogin();const e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp(e){let{email:t}=e;await this.preLogin();const i=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0});return this.postLogin(i)}getOauthPopUpSizing(e){return e===v.FACEBOOK?"width=715, height=555":"width=350, height=500"}async loginWithOauth(e){let t=null===e||void 0===e?void 0:e.openedWindow,i=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),i=!0),!t)throw new Error("Something went wrong opening pop-up");const[{loginLink:n}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=n;const a=await new Promise(((n,a)=>{const s=window.setInterval((async()=>{t&&t.closed&&(clearInterval(s),window.removeEventListener("message",r),a(new Error("User closed login window")))}),1e3),r=async o=>{if(o.origin===w())if("object"===typeof o.data)switch(o.data.eventType){case"userLoginSuccess":window.removeEventListener("message",r),clearInterval(s),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null===e||void 0===e?void 0:e.closeOpenedWindow}),o.data.authResult&&n(o.data.authResult);break;case"userLoginFailed":window.removeEventListener("message",r),clearInterval(s),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null===e||void 0===e?void 0:e.closeOpenedWindow}),a(new Error(o.data.error));break;case"injectDeveloperClientId":var l;null===(l=t)||void 0===l||l.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.clientId,authOption:e.oauthProvider},w())}else a(new Error("Invalid event data"))};window.addEventListener("message",r)}));return this.postLogin({storedToken:{...a.storedToken,shouldStoreCookieString:!0},walletDetails:{...a.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;await this.preLogin();const n=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}});return this.postLogin(n)}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;await this.preLogin();const n=await this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:i}});return this.postLogin(n)}async verifyEmailLoginOtp(e){let{email:t,otp:i,recoveryCode:n}=e;const a=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:n}});return this.postLogin(a)}}class T{constructor(e){let{clientId:t,querier:i,onAuthSuccess:n}=e;this.clientId=t,this.AuthQuerier=i,this.localStorage=new L({clientId:t}),this.onAuthSuccess=n,this.BaseLogin=new C({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},querier:i,clientId:t})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithModal(){return this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}}class N extends d.Signer{constructor(e){var t;let{provider:i,clientId:n,querier:s}=e;super(),(0,a._)(this,"DEFAULT_ETHEREUM_CHAIN_ID",5),this.clientId=n,this.querier=s,this.endpoint=null===(t=i.connection)||void 0===t?void 0:t.url,(0,u.defineReadOnly)(this,"provider",i)}async getAddress(){const{address:e}=await this.querier.call({procedureName:"getAddress",params:void 0});return e}async signMessage(e){var t,i,n;const{signedMessage:a}=await this.querier.call({procedureName:"signMessage",params:{message:e,chainId:null!==(t=null===(i=await(null===(n=this.provider)||void 0===n?void 0:n.getNetwork()))||void 0===i?void 0:i.chainId)&&void 0!==t?t:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return a}async signTransaction(e){var t,i,n;const{signedTransaction:a}=await this.querier.call({procedureName:"signTransaction",params:{transaction:e,chainId:null!==(t=null===(i=await(null===(n=this.provider)||void 0===n?void 0:n.getNetwork()))||void 0===i?void 0:i.chainId)&&void 0!==t?t:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return a}async sendTransaction(e){if(!this.provider)throw new Error("Provider not found");const t={...await(0,p.g)(this.provider),...e};return super.sendTransaction(t)}async _signTypedData(e,t,i){var n,a,s;const{signedTypedData:r}=await this.querier.call({procedureName:"signTypedDataV4",params:{domain:e,types:t,message:i,chainId:null!==(n=null===(a=await(null===(s=this.provider)||void 0===s?void 0:s.getNetwork()))||void 0===a?void 0:a.chainId)&&void 0!==n?n:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return r}connect(e){return new N({clientId:this.clientId,provider:e,querier:this.querier})}}class U{constructor(e){let{clientId:t,chain:i,querier:n}=e;this.clientId=t,this.chain=i,this.walletManagerQuerier=n,this.localStorage=new L({clientId:t})}async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:i,isIframeStorageEnabled:n,walletUserId:a}=e;return n||await this.localStorage.saveDeviceShare(t,a),{walletAddress:i}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===y.LOGGED_IN_WALLET_INITIALIZED?{status:y.LOGGED_IN_WALLET_INITIALIZED,...e.user,wallet:this}:e.status===y.LOGGED_IN_NEW_DEVICE||e.status===y.LOGGED_IN_WALLET_UNINITIALIZED?{status:y.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async setChain(e){let{chain:t}=e;this.chain=t}async getEthersJsSigner(e){var t;return new N({clientId:this.clientId,provider:(0,h.getDefaultProvider)(null!==(t=null===e||void 0===e?void 0:e.rpcEndpoint)&&void 0!==t?t:c.eY[this.chain]),querier:this.walletManagerQuerier})}}class k{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor(e){let{clientId:t,chain:i,styles:n,onAuthSuccess:a}=e;if(this.isClientIdLegacyPaper(t))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");this.clientId=t,this.querier=new _({clientId:t,customizationOptions:n}),this.wallet=new U({clientId:t,chain:i,querier:this.querier}),this.auth=new T({clientId:t,querier:this.querier,onAuthSuccess:async e=>(null===a||void 0===a||a(e),await this.wallet.postWalletSetUp({...e.walletDetails,walletUserId:e.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{deviceShareStored:e.walletDetails.deviceShareStored,clientId:this.clientId,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:y.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,wallet:this.wallet,walletAddress:e.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}}i(67112);var P=new WeakMap,G=new WeakMap;class M extends l.C{constructor(e){super(),(0,a._)(this,"id",o.w.paper),(0,a._)(this,"name","Embedded Wallet"),(0,a._)(this,"ready",!0),(0,a._)(this,"user",null),(0,n._)(this,P,{writable:!0,value:void 0}),(0,n._)(this,G,{writable:!0,value:void 0}),(0,a._)(this,"onAccountsChanged",(async e=>{0===e.length?await this.onDisconnect():this.emit("change",{account:s.getAddress(e[0])})})),(0,a._)(this,"onChainChanged",(e=>{const t=(0,r.n)(e),i=-1===this.options.chains.findIndex((e=>e.chainId===t));this.emit("change",{chain:{id:t,unsupported:i}})})),(0,a._)(this,"onDisconnect",(async()=>{this.emit("disconnect")})),this.options=e}getEmbeddedWalletSDK(){return(0,n.b)(this,P)||(0,n.a)(this,P,new k({clientId:this.options.clientId,chain:"Ethereum",onAuthSuccess:this.options.onAuthSuccess})),(0,n.b)(this,P)}async connect(e){if(e){if(!e.authResult)throw new Error("Missing authData - call authenticate() first with your authentication strategy");if(!e.authResult.user)throw new Error("Missing authData.user - call authenticate() first with your authentication strategy");this.user=e.authResult.user}else{const e=await this.authenticate({strategy:"iframe"});if(!e.user)throw new Error("Error connecting User");this.user=e.user}return null!==e&&void 0!==e&&e.chainId&&this.switchChain(e.chainId),this.getAddress()}async disconnect(){const e=(0,n.b)(this,P);await(null===e||void 0===e?void 0:e.auth.logout()),(0,n.a)(this,G,void 0),(0,n.a)(this,P,void 0),this.user=null}async getAddress(){if(!this.user)throw new Error("Embedded Wallet is not connected");return await this.getSigner().then((e=>e.getAddress()))}async isConnected(){try{return!!await this.getAddress()}catch(e){return!1}}async getProvider(){const e=await this.getSigner();if(!e.provider)throw new Error("Provider not found");return e.provider}async getSigner(){if((0,n.b)(this,G))return(0,n.b)(this,G);const e=await this.getUser(),t=await e.wallet.getEthersJsSigner({rpcEndpoint:this.options.chain.rpc[0]||""});if(!t)throw new Error("Signer not found");return(0,n.a)(this,G,t),t}async isAuthorized(){return!1}async switchChain(e){const t=this.options.chains.find((t=>t.chainId===e));if(!t)throw new Error("Chain not configured");try{var i,a;await(null===(i=this.user)||void 0===i?void 0:i.wallet.setChain({chain:"Ethereum"})),(0,n.a)(this,G,await(null===(a=this.user)||void 0===a?void 0:a.wallet.getEthersJsSigner({rpcEndpoint:t.rpc[0]||""}))),this.emit("change",{chain:{id:e,unsupported:!1}})}catch(s){console.warn("Failed to switch chain",s)}}async setupListeners(){return Promise.resolve()}updateChains(e){this.options.chains=e}async getUser(){if(!this.user||!this.user.wallet||!this.user.wallet.getEthersJsSigner){const e=this.getEmbeddedWalletSDK(),t=await e.getUser();if(t.status!==y.LOGGED_IN_WALLET_INITIALIZED)throw new Error("Embedded Wallet is not authenticated, please authenticate first");this.user=t}return this.user}async getEmail(){return(await this.getUser()).authDetails.email}async getRecoveryInformation(){return(await this.getUser()).authDetails}async sendVerificationEmail(e){let{email:t}=e;return this.getEmbeddedWalletSDK().auth.sendEmailLoginOtp({email:t})}async authenticate(e){const t=this.getEmbeddedWalletSDK(),i=e.strategy;switch(i){case"email_verification":return await t.auth.verifyEmailLoginOtp({email:e.email,otp:e.verificationCode,recoveryCode:e.recoveryCode});case"apple":case"facebook":case"google":{const n=B[i];return t.auth.loginWithOauth({oauthProvider:n,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow})}case"jwt":return t.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return t.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return t.auth.loginWithEmailOtp({email:e.email});case"iframe":return t.auth.loginWithModal();default:!function(e){throw new Error("Invalid param: "+e)}(i)}}}const B={google:v.GOOGLE,facebook:v.FACEBOOK,apple:v.APPLE}},80080:(e,t,i)=>{i.d(t,{IZ:()=>a,eY:()=>n});var n={Ethereum:"https://ethereum.rpc.thirdweb.com",Goerli:"https://goerli.rpc.thirdweb.com",Mumbai:"https://mumbai.rpc.thirdweb.com",Polygon:"https://polygon.rpc.thirdweb.com",Avalanche:"https://avalanche.rpc.thirdweb.com",Optimism:"https://optimism.rpc.thirdweb.com",OptimismGoerli:"https://optimism-goerli.rpc.thirdweb.com",BSC:"https://binance.rpc.thirdweb.com",BSCTestnet:"https://binance-testnet.rpc.thirdweb.com",ArbitrumOne:"https://arbitrum.rpc.thirdweb.com",ArbitrumGoerli:"https://arbitrum-goerli.rpc.thirdweb.com",Fantom:"https://fantom.rpc.thirdweb.com",FantomTestnet:"https://fantom-testnet.rpc.thirdweb.com",Sepolia:"https://sepolia.rpc.thirdweb.com",AvalancheFuji:"https://avalanche-fuji.rpc.thirdweb.com"},a=()=>{var e;return"undefined"!=typeof window&&"true"===window.localStorage.getItem("IS_PAPER_DEV")?null!=(e=window.localStorage.getItem("PAPER_DEV_URL"))?e:"http://localhost:3000":"undefined"!=typeof window&&window.location.origin.includes("paper.xyz")||"undefined"!=typeof window&&window.location.origin.includes("thirdweb.com")?window.location.origin:"https://withpaper.com"}}}]);
//# sourceMappingURL=8452.172c3c17.chunk.js.map